+ export VLLM_ATTENTION_BACKEND=XFORMERS
+ VLLM_ATTENTION_BACKEND=XFORMERS
++ pwd
+ export PYTHONPATH=/home/bingxing2/ailab/wangkuncan/soft/l1/scripts/train/../../verl/
+ PYTHONPATH=/home/bingxing2/ailab/wangkuncan/soft/l1/scripts/train/../../verl/
+ export LD_PRELOAD=:/home/bingxing2/ailab/wangkuncan/.conda/envs/L1/lib/python3.10/site-packages/scikit_learn.libs/libgomp-d22c30c5.so.1.0.0
+ LD_PRELOAD=:/home/bingxing2/ailab/wangkuncan/.conda/envs/L1/lib/python3.10/site-packages/scikit_learn.libs/libgomp-d22c30c5.so.1.0.0
+ [[ 0 -gt 0 ]]
+ '[' -z '' ']'
+ MODEL_PATH=agentica-org/DeepScaleR-1.5B-Preview
+ python3 -m verl.trainer.main_ppo algorithm.adv_estimator=grpo data.train_files=/home/bingxing2/ailab/wangkuncan/deepscaler/data/mmlu_1000.parquet data.val_files=/home/bingxing2/ailab/wangkuncan/deepscaler/data/mmlu_1000.parquet data.train_batch_size=128 data.val_batch_size=512 data.max_prompt_length=1024 data.max_response_length=4096 actor_rollout_ref.model.path=agentica-org/DeepScaleR-1.5B-Preview actor_rollout_ref.actor.optim.lr=1e-6 actor_rollout_ref.model.use_remove_padding=True actor_rollout_ref.actor.ppo_mini_batch_size=64 actor_rollout_ref.actor.use_dynamic_bsz=True actor_rollout_ref.actor.ppo_max_token_len_per_gpu=32768 actor_rollout_ref.actor.use_kl_loss=True actor_rollout_ref.actor.kl_loss_coef=0.001 actor_rollout_ref.actor.kl_loss_type=low_var_kl actor_rollout_ref.actor.ulysses_sequence_parallel_size=1 actor_rollout_ref.model.enable_gradient_checkpointing=True actor_rollout_ref.actor.fsdp_config.param_offload=False actor_rollout_ref.actor.fsdp_config.grad_offload=False actor_rollout_ref.actor.fsdp_config.optimizer_offload=False actor_rollout_ref.rollout.tensor_model_parallel_size=2 actor_rollout_ref.rollout.name=vllm actor_rollout_ref.rollout.temperature=0.6 actor_rollout_ref.rollout.val_temperature=0.6 actor_rollout_ref.rollout.gpu_memory_utilization=0.8 actor_rollout_ref.rollout.n=16 actor_rollout_ref.rollout.n_val=16 actor_rollout_ref.ref.fsdp_config.param_offload=True algorithm.kl_ctrl.kl_coef=0.001 trainer.critic_warmup=0 'trainer.logger=[console,wandb]' trainer.project_name=deepscaler trainer.experiment_name=l1_exact +trainer.val_before_train=True trainer.n_gpus_per_node=4 trainer.nnodes=1 trainer.save_freq=20 trainer.test_freq=20 trainer.default_hdfs_dir=null trainer.total_epochs=3
2025-05-12 13:49:46,484	INFO worker.py:1843 -- Started a local Ray instance. View the dashboard at [1m[32m127.0.0.1:8265 [39m[22m
Error executing job with overrides: ['algorithm.adv_estimator=grpo', 'data.train_files=/home/bingxing2/ailab/wangkuncan/deepscaler/data/mmlu_1000.parquet', 'data.val_files=/home/bingxing2/ailab/wangkuncan/deepscaler/data/mmlu_1000.parquet', 'data.train_batch_size=128', 'data.val_batch_size=512', 'data.max_prompt_length=1024', 'data.max_response_length=4096', 'actor_rollout_ref.model.path=agentica-org/DeepScaleR-1.5B-Preview', 'actor_rollout_ref.actor.optim.lr=1e-6', 'actor_rollout_ref.model.use_remove_padding=True', 'actor_rollout_ref.actor.ppo_mini_batch_size=64', 'actor_rollout_ref.actor.use_dynamic_bsz=True', 'actor_rollout_ref.actor.ppo_max_token_len_per_gpu=32768', 'actor_rollout_ref.actor.use_kl_loss=True', 'actor_rollout_ref.actor.kl_loss_coef=0.001', 'actor_rollout_ref.actor.kl_loss_type=low_var_kl', 'actor_rollout_ref.actor.ulysses_sequence_parallel_size=1', 'actor_rollout_ref.model.enable_gradient_checkpointing=True', 'actor_rollout_ref.actor.fsdp_config.param_offload=False', 'actor_rollout_ref.actor.fsdp_config.grad_offload=False', 'actor_rollout_ref.actor.fsdp_config.optimizer_offload=False', 'actor_rollout_ref.rollout.tensor_model_parallel_size=2', 'actor_rollout_ref.rollout.name=vllm', 'actor_rollout_ref.rollout.temperature=0.6', 'actor_rollout_ref.rollout.val_temperature=0.6', 'actor_rollout_ref.rollout.gpu_memory_utilization=0.8', 'actor_rollout_ref.rollout.n=16', 'actor_rollout_ref.rollout.n_val=16', 'actor_rollout_ref.ref.fsdp_config.param_offload=True', 'algorithm.kl_ctrl.kl_coef=0.001', 'trainer.critic_warmup=0', 'trainer.logger=[console,wandb]', 'trainer.project_name=deepscaler', 'trainer.experiment_name=l1_exact', '+trainer.val_before_train=True', 'trainer.n_gpus_per_node=4', 'trainer.nnodes=1', 'trainer.save_freq=20', 'trainer.test_freq=20', 'trainer.default_hdfs_dir=null', 'trainer.total_epochs=3']
[36m(main_task pid=3438924)[0m Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): [36mray::WorkerDict.ref_init_model()[39m (pid=3446153, ip=173.3.222.105, actor_id=06d8613c2b5cebe0f88ec4eb01000000, repr=<verl.single_controller.ray.base.WorkerDict object at 0x40160364b6a0>)
[36m(main_task pid=3438924)[0m   File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/single_controller/ray/base.py", line 399, in func
[36m(main_task pid=3438924)[0m     return getattr(self.worker_dict[key], name)(*args, **kwargs)
[36m(main_task pid=3438924)[0m   File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/single_controller/base/decorator.py", line 404, in inner
[36m(main_task pid=3438924)[0m     return func(*args, **kwargs)
[36m(main_task pid=3438924)[0m   File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/workers/fsdp_workers.py", line 311, in init_model
[36m(main_task pid=3438924)[0m     from verl.workers.actor import DataParallelPPOActor
[36m(main_task pid=3438924)[0m   File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/workers/actor/__init__.py", line 16, in <module>
[36m(main_task pid=3438924)[0m     from .dp_actor import DataParallelPPOActor
[36m(main_task pid=3438924)[0m   File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/workers/actor/dp_actor.py", line 34, in <module>
[36m(main_task pid=3438924)[0m     from flash_attn.bert_padding import pad_input, unpad_input, rearrange, index_first_axis
[36m(main_task pid=3438924)[0m ModuleNotFoundError: No module named 'flash_attn'
Traceback (most recent call last):
  File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/trainer/main_ppo.py", line 124, in main
    ray.get(main_task.remote(config))
  File "/home/bingxing2/ailab/wangkuncan/.local/lib/python3.10/site-packages/ray/_private/auto_init_hook.py", line 21, in auto_init_wrapper
    return fn(*args, **kwargs)
  File "/home/bingxing2/ailab/wangkuncan/.local/lib/python3.10/site-packages/ray/_private/client_mode_hook.py", line 103, in wrapper
    return func(*args, **kwargs)
  File "/home/bingxing2/ailab/wangkuncan/.local/lib/python3.10/site-packages/ray/_private/worker.py", line 2782, in get
    values, debugger_breakpoint = worker.get_objects(object_refs, timeout=timeout)
  File "/home/bingxing2/ailab/wangkuncan/.local/lib/python3.10/site-packages/ray/_private/worker.py", line 929, in get_objects
    raise value.as_instanceof_cause()
ray.exceptions.RayTaskError(ModuleNotFoundError): [36mray::main_task()[39m (pid=3438924, ip=173.3.222.105)
  File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/trainer/main_ppo.py", line 210, in main_task
    trainer.init_workers()
  File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/trainer/ppo/ray_trainer.py", line 523, in init_workers
    self.ref_policy_wg.init_model()
  File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/single_controller/ray/base.py", line 42, in func
    output = ray.get(output)
ray.exceptions.RayTaskError(ModuleNotFoundError): [36mray::WorkerDict.ref_init_model()[39m (pid=3446154, ip=173.3.222.105, actor_id=ebf5d6891d0ed7df1e1a831901000000, repr=<verl.single_controller.ray.base.WorkerDict object at 0x4014f483b2b0>)
  File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/single_controller/ray/base.py", line 399, in func
    return getattr(self.worker_dict[key], name)(*args, **kwargs)
  File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/single_controller/base/decorator.py", line 404, in inner
    return func(*args, **kwargs)
  File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/workers/fsdp_workers.py", line 311, in init_model
    from verl.workers.actor import DataParallelPPOActor
  File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/workers/actor/__init__.py", line 16, in <module>
    from .dp_actor import DataParallelPPOActor
  File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/workers/actor/dp_actor.py", line 34, in <module>
    from flash_attn.bert_padding import pad_input, unpad_input, rearrange, index_first_axis
ModuleNotFoundError: No module named 'flash_attn'

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
[36m(main_task pid=3438924)[0m Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): [36mray::WorkerDict.ref_init_model()[39m (pid=3446155, ip=173.3.222.105, actor_id=25b4e3e0509076d707e4f63901000000, repr=<verl.single_controller.ray.base.WorkerDict object at 0x4015c77c72e0>)
[36m(main_task pid=3438924)[0m   File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/single_controller/ray/base.py", line 399, in func
[36m(main_task pid=3438924)[0m     return getattr(self.worker_dict[key], name)(*args, **kwargs)
[36m(main_task pid=3438924)[0m   File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/single_controller/base/decorator.py", line 404, in inner
[36m(main_task pid=3438924)[0m     return func(*args, **kwargs)
[36m(main_task pid=3438924)[0m   File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/workers/fsdp_workers.py", line 311, in init_model
[36m(main_task pid=3438924)[0m     from verl.workers.actor import DataParallelPPOActor
[36m(main_task pid=3438924)[0m   File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/workers/actor/__init__.py", line 16, in <module>
[36m(main_task pid=3438924)[0m     from .dp_actor import DataParallelPPOActor
[36m(main_task pid=3438924)[0m   File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/workers/actor/dp_actor.py", line 34, in <module>
[36m(main_task pid=3438924)[0m     from flash_attn.bert_padding import pad_input, unpad_input, rearrange, index_first_axis
[36m(main_task pid=3438924)[0m ModuleNotFoundError: No module named 'flash_attn'
[36m(main_task pid=3438924)[0m Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): [36mray::WorkerDict.ref_init_model()[39m (pid=3445788, ip=173.3.222.105, actor_id=e37c7d5fcf213244a55299af01000000, repr=<verl.single_controller.ray.base.WorkerDict object at 0x4016a172cbe0>)
[36m(main_task pid=3438924)[0m   File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/single_controller/ray/base.py", line 399, in func
[36m(main_task pid=3438924)[0m     return getattr(self.worker_dict[key], name)(*args, **kwargs)
[36m(main_task pid=3438924)[0m   File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/single_controller/base/decorator.py", line 404, in inner
[36m(main_task pid=3438924)[0m     return func(*args, **kwargs)
[36m(main_task pid=3438924)[0m   File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/workers/fsdp_workers.py", line 311, in init_model
[36m(main_task pid=3438924)[0m     from verl.workers.actor import DataParallelPPOActor
[36m(main_task pid=3438924)[0m   File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/workers/actor/__init__.py", line 16, in <module>
[36m(main_task pid=3438924)[0m     from .dp_actor import DataParallelPPOActor
[36m(main_task pid=3438924)[0m   File "/home/bingxing2/ailab/wangkuncan/soft/l1/verl/verl/workers/actor/dp_actor.py", line 34, in <module>
[36m(main_task pid=3438924)[0m     from flash_attn.bert_padding import pad_input, unpad_input, rearrange, index_first_axis
[36m(main_task pid=3438924)[0m ModuleNotFoundError: No module named 'flash_attn'
